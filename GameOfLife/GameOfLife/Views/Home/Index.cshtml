@model GameOfLife.Models.Board

@Scripts.Render("~/bundles/jquery")

@{
    ViewBag.Title = "Game of Life Web Application";
}

<div class="jumbotron">
    <h1>Welecom to the Game of Life!</h1>
    @*<p class="lead">ASP.NET is a free web framework for building great Web sites and Web applications using HTML, CSS and JavaScript.</p>
    <p><a href="http://asp.net" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>*@
</div>

<input type="hidden" value="@ViewBag.GameStarted.ToString()" id="gameStarted"/>
<div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
        @if (Model != null)
        {
            <form action="@Url.Action("StartGame")" method="post" id="frmStartGame">
                @foreach (var cell in Model.BoardCells)
                {
                    <div class="@(cell.Column%Model.Size == 1 && cell.Row > 1 ? "after-box" : "") floating-box @(cell.Live ? "box-red" : "")">
                        <input type="hidden" name="row_@(cell.Row)_@(cell.Column)" value="@cell.Row"/>
                        <input type="hidden" name="column_@(cell.Row)_@(cell.Column)" value="@cell.Column"/>
                        <input type="hidden" name="live_@(cell.Row)_@(cell.Column)" value="@cell.Live.ToString()"/>
                    </div>
                }
            </form>
        }
    </div>
    <div class="col-md-2"></div>
</div>

<div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
        <button id="initiate">
            <script type="text/javascript">
                if ($('#gameStarted').val() == 'True') {
                    $('#initiate').text("Stop");
                } else {
                    $('#initiate').text("Start");
                }
            </script>
        </button>
    </div>
</div>

<script type="text/javascript">
    $('.floating-box,.after-box').click(function() {
        $(this).toggleClass('box-red');
        var target = $(this).find('[name^="live"]');
        if ($(target).val() == 'False') {
            $(target).val('True');
        } else {
            $(target).val('False');
        }
    });

    function startOrStopGame() {
        var timer;
        if ($('#gameStarted').val() == 'True') {
            timer = setTimeout(function() {
                $('#frmStartGame').submit();
            }, 2000);
            $("#initiate").click(function() {
                clearTimeout(timer);
                $('#initiate').text("Start");
                $('#gameStarted').val('False');
                startOrStopGame();
            });
        } else {
            $("#initiate").click(function() {
                $('#frmStartGame').submit();
            });
        }
    }

    startOrStopGame();
</script>